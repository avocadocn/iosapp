ion-view.discuss_list(ng-controller="DiscussListController")

  ion-header-bar
    a.button(href="#/calendar/discuss_list")
      svg.svg_icon.svg_nav_icon
        use(xlink:href="#richeng")
    h1.title 讨论列表
    //- a.button.icon.ion-plus(href="#/campaign/sponsor/discuss_list")

  ion-content
    ion-refresher(on-refresh="refresh()" refreshing-icon="ion-looping" pulling-text="下拉刷新" refreshing-text="刷新中...")
    ul.list(ng-if='chatrooms')
      .custom_items(ng-repeat="chatroom in chatrooms track by $index" ng-click="goDetail(chatroom, $index)" ng-cloak)
        a.item.item-avatar_custom
          img(img-cache ic-src="{{STATIC_URL + chatroom.logo + '/45/45'}}")
          //-img(bo-if="chatroom.kind==='company'" src="img/icons/unjoined_discuss.png")
          .red_spot(ng-if="chatroom.unreadMessagesCount")
          h2(ng-bind="chatroom.name")

          p.chat_pre(ng-if="chatroom.latestMessage" ng-cloak)
            span(ng-show="chatroom.unreadMessagesCount") [{{chatroom.unreadMessagesCount}}条新消息]
            //-poster为小队？todo.
            span(ng-cloak ng-if="chatroom.latestMessage.poster") {{chatroom.latestMessage.poster.nickname}}:
            span(ng-cloak ng-if="!chatroom.latestMessage.type || chatroom.latestMessage.type==='TXT'" ng-bind-html=" chatroom.latestMessage.body.text | emoji | unsafe")
            span(ng-cloak ng-if="chatroom.latestMessage.type==='IMAGE'") {{'[图片]'}}
            span(ng-cloak ng-if="chatroom.latestMessage.type==='VOICE'") {{'[语音]'}}
            span.time(bo-text="(chatroom.latestMessage.msgTime | date: 'M月dd日 HH:mm')")
        .custom_border(ng-class="{non_last_custom_border: $index!==chatrooms.length - 1}")
    .no_campaign(ng-cloak ng-if="loadFinished && !chatrooms.length")
      a.no_campaign_tip.no_underline(href="#/company/teams/official")
          p 没有参加小队?
          p 参加小队后一起讨论吧！
          p.button_container
            //- span.tip_info 点击
            span.team_link 全部小队
