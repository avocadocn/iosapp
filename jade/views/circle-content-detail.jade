ion-view.circle_content_detail_page
  ion-header-bar
    button.button.icon-left.ion-chevron-left(ng-click="goBack()") &nbsp;返回
    h1.title 详情
  
  ion-content
    .dl_circle_company_card.clearfix
      img.circle_company_logo(ng-src="{{STATIC_URL + circle.content.poster.photo}}/32/32")
      .circle_info
        h2.user_name.link_name(ng-click="goToUserPage(circle.content.poster._id)") {{circle.content.poster.nickname}}
        p.circle_content {{circle.content.content}}
        .image_box.clearfix
          img.preview_img(ng-repeat="photo in circle.content.photos" ng-src="{{STATIC_URL + photo.uri}}/128/128" open-photo error-img photo="photo" pswp-id="circlePswpId" photos="imagesForPswp")
        .date_and_op
          span.date {{circle.content.post_date | beforeNow}}
          span.delete(ng-if="user._id == circle.content.post_user_id" ng-click="deleteCircleContent(circle)") 删除
          i.ion_comment.op_icon(ng-click="toComment(circle)")
        .comment_op(ng-if="circle.isToComment")
          span.op(ng-if="!hasAppreciate(circle)" ng-click="appreciate(circle)") 赞
          span.op(ng-if="hasAppreciate(circle)" ng-click="cancelAppreciate(circle)" ng-cloak) 取消赞
          span.divider |
          span.op(ng-click="openCommentBox(circle)") 评论
      .circle_comment_list
        .appreciate_container(ng-if="circle.appreciate.length > 0")
          i.ion-heart
          a.appreciate.link_name(ng-repeat="appr in circle.appreciate" ng-href="#/user/{{appr.poster._id}}") {{appr.poster.nickname}}
        .comment_container(ng-if="circle.textComments.length > 0")
          .comment(ng-repeat="comment in circle.textComments" ng-click="replyTo(circle, comment)" on-hold="commentOnHoldHandler(comment, circle.textComments)")
            span.nickname.link_name(ng-click="goToUserPage(comment.poster._id)" prevent-default) {{comment.poster.nickname}}
            span.reply_text(ng-if="!comment.is_only_to_content" ng-cloak) 回复
            span.reply_to.link_name(ng-if="!comment.is_only_to_content" ng-click="goToUserPage(comment.target._id)" prevent-default ng-cloak) {{comment.target.nickname}}
            span.colon :
            span.content(ng-bind-html="comment.content | emoji | unsafe")
            
  .comment_wrap(ng-if="isCommenting" ng-click="stopComment()")
  
  .bar.bar-footer.item-input-inset.circle_comment_box(ng-if="isCommenting" ng-class="{'show_emotion_box': isShowEmotions}")
    .item-input-wrapper
      i.icon.ion-happy.placeholder-icon(ng-click="toggleEmotions()")
      input(type="text" ng-model="commentFormData.content" when-focus="isCommenting" ng-focus="hideEmotions()" placeholder="{{commentPlaceholderText}}" required)
    button.button.button-clear(ng-click="comment()") 发表
  ion-slide-box.emotion_box(ng-if="isShowEmotions")
    ion-slide(ng-repeat="emoji in emojiList")
      .box.clearfix
        .emotion(ng-repeat="emotion in emoji" ng-click="addEmotion(emotion)")
          i(class="emoji {{'emoji_'+emotion}}")

  .pswp(tabindex="-1" role="dialog" aria-hidden="true" id="{{circlePswpId}}")
    .pswp__bg
    .pswp__scroll-wrap
      .pswp__container
        .pswp__item
        .pswp__item
        .pswp__item
      .pswp__ui.pswp__ui--hidden
        .pswp__top-bar
          .pswp__counter
          button.pswp__button.pswp__button--close(title="关闭")
          button.pswp__button.pswp__button--zoom(title="放大/缩小")
            i.icon.ion-image
          .pswp__preloader
            .pswp__preloader__icn
              .pswp__preloader__cut
                .pswp__preloader__donut
        button.pswp__button.pswp__button--arrow--left(title="上一张")
        button.pswp__button.pswp__button--arrow--right(title="下一张")
        .pswp__caption
          .pswp__caption__center
