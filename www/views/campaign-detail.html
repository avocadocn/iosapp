
<ion-view bindonce="campaign" class="dl_campaign_detail">
  <ion-header-bar><a ng-click="goBack()" class="button icon-left ion-chevron-left">&nbsp;返回</a>
    <h1 bo-text="campaign.campaign_unit[0].team.name || campaign.campaign_unit[0].company.name" class="title"></h1><a ng-if="campaign.active &amp;&amp; campaign.allow.editTeamCampaign || campaign.allow.editCompanyCampaign" href="#/campaign/edit/{{campaign._id}}" class="button dl_cp_edit">编辑</a>
  </ion-header-bar>
  <ion-content delegate-handle="detailScroll">
    <ion-refresher refreshing-icon="ion-looping" on-refresh="doRefresh()"></ion-refresher>
    <div class="campaign_detail">
      <div bo-if="campaign.campaign_unit.length==2" class="item item_header campaign_theme"><span bo-text="campaign.theme"></span></div>
      <score-board bo-if="campaign.campaign_unit.length==2" component-id="scoreBoardId" campaign="campaign" reload-flag="reloadFlag"></score-board>
      <div bo-if="campaign.campaign_unit.length==1" class="campaign_info">
        <div class="cp_logos logos_{{campaign.campaign_unit.length}}"><a bo-href="campaign.campaign_unit[0].team._id ? '#/team/'+ campaign.campaign_unit[0].team._id: ''"><img bo-src="STATIC_URL + (campaign.campaign_unit[0].team.logo || campaign.campaign_unit[0].company.logo)+'/60/60'" class="team_logo"/></a></div>
        <div bo-text="campaign.theme + (!campaign || campaign.active ? '' : '(已关闭)')" class="campaign_theme"></div>
        <div class="operator">
          <button ng-if="campaign.allow.joinTeamCampaign || campaign.allow.joinCompanyCampaign" ng-click="join(campaign._id)" class="button dl_cp_join">马上参加</button>
        </div>
        <div class="campaign_status"><span ng-class="{'now':campaign.is_start&amp;&amp;!campaign.is_end,'unstart':!campaign.is_start,'unjoin':campaign.join_flag!=1}" class="status">{{campaign.is_start | campaignStatus:campaign.is_end}}</span></div>
      </div>
      <div class="campaign_items">
        <div class="item item_header cp_time">
          <svg class="svg_icon">
            <use xlink:href="#time"></use>
          </svg><span bo-text="(campaign.start_time | date:'MM-dd HH:mm') +'~' + (campaign.end_time | date:'MM-dd  HH:mm')"></span>
        </div><a bo-href="'#/location/'+campaign._id" class="item item_header cp_address">
          <svg class="svg_icon cp_info_icon">
            <use xlink:href="#location"></use>
          </svg><span bo-text="campaign.location.name" class="cp_location"></span><span class="icon icon_small ion-chevron-right button-clear"></span></a>
      </div>
      <div class="campaign_items"><a bo-href="'#/campaign/content/'+campaign._id" class="item item_header item_title">
          <svg class="svg_icon">
            <use xlink:href="#xiangqing"></use>
          </svg><span>活动详情</span><span class="icon icon_small ion-chevron-right button-clear"></span></a>
        <div ng-if="campaign.content" class="item item-text-wrap campaign_content">
          <p bo-text="campaign.content" class="content_simple"></p>
        </div>
      </div>
      <div class="item campaign_footer"><a bo-href="'#/members/campaign/'+campaign._id" class="footer_col">
          <svg class="svg_icon">
            <use xlink:href="#yibaoming"></use>
          </svg><span bo-text="'已报名('+campaign.members_count+')'" class="footer_label"></span></a>
        <div ng-click="goDiscussDetail(campaign._id, campaign.theme)" class="footer_col">
          <svg class="svg_icon discussion_icon">
            <use xlink:href="#taolun"></use>
          </svg><span class="footer_label">活动讨论</span>
        </div>
      </div>
      <div class="item item-divider circle"><span>精彩瞬间</span>
        <svg ng-if="campaign.join_flag==1" post-circle="post-circle" campaign="campaign" after-post="doRefresh()" class="svg_icon">
          <use xlink:href="#camera"></use>
        </svg>
      </div>
      <circle-card-list circle-list="circleContentList" user="user" ctrl="circleCardListCtrl" on-click-comment-button="openCommentBox" on-click-content-img="onClickContentImg" on-click-blank="clickBlank" static-url="STATIC_URL"></circle-card-list>
      <ion-infinite-scroll ng-if="loadingStatus.hasMore &amp;&amp; loadingStatus.hasInit" icon="ion-looping" on-infinite="loadMore()" distance="1%"></ion-infinite-scroll>
    </div>
  </ion-content>
  <circle-comment-box ctrl="circleCommentBoxCtrl" on-post="postComment"></circle-comment-box>
  <photo-swipe ctrl="pswpCtrl"></photo-swipe>
  <ion-footer-bar ng-if="campaign.active &amp;&amp;(campaign.allow.joinTeamCampaign || campaign.allow.joinCompanyCampaign ||campaign.allow.quitCampaign)">
    <button ng-if="campaign.allow.joinTeamCampaign || campaign.allow.joinCompanyCampaign" ng-click="join(campaign._id)" class="button button-full dl_cp_join">报名参加</button>
    <button ng-if="campaign.allow.quitCampaign" ng-click="quit(campaign._id)" class="button button-full dl_cp_quit">已经参加</button>
  </ion-footer-bar>
</ion-view>