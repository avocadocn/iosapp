
<ion-view class="dl_campaign_detail">
  <ion-header-bar><a ng-click="goBack()" class="button icon-left ion-chevron-left">&nbsp;返回</a>
    <h1 ng-bind="campaign.campaign_unit[0].team.name || campaign.campaign_unit[0].company.name" class="title"></h1><a ng-if="campaign.active &amp;&amp; campaign.allow.editTeamCampaign || campaign.allow.editCompanyCampaign" href="#/campaign/edit/{{campaign._id}}" class="button dl_cp_edit">编辑</a>
  </ion-header-bar>
  <ion-content delegate-handle="detailScroll">
    <div ng-if="campaign" class="campaign_detail">
      <div class="campaign_info">
        <div class="cp_logos logos_{{campaign.campaign_unit.length}}"><a ng-href="{{campaign.campaign_unit[0].team._id ? '#/team/'+ campaign.campaign_unit[0].team._id: ''}}"><img ng-repeat="campaign_unit in campaign.campaign_unit" ng-src="{{STATIC_URL + (campaign_unit.team.logo || campaign_unit.company.logo)}}/60/60" class="team_logo"/></a>
          <div ng-if="campaign.campaign_type===4 || campaign.campaign_type===5" class="provoke_label"><span>挑战</span></div>
          <div ng-if="campaign.campaign_type===7" class="fellowship_label"><span>联谊 </span></div><a ng-href="{{campaign.campaign_unit[0].team._id ? '#/team/'+ campaign.campaign_unit[0].team._id: ''}}"></a>
        </div>
        <div ng-cloak="ng-cloak" class="campaign_theme"> {{campaign.theme + (!campaign || campaign.active ? '' : '(已关闭)')}}</div>
        <div class="cp_time"><i class="icon icon_small ion_time"></i><span ng-cloak="ng-cloak">{{campaign.start_time | date:"MM-dd HH:mm"}} ~~ {{campaign.end_time | date:"MM-dd  HH:mm" }}</span></div>
      </div>
      <div class="campaign_status"><span ng-cloak="ng-cloak" class="dl_cp_time">{{campaign.create_time | beforeNow}}发布</span><span ng-class="{'now':campaign.is_start&amp;&amp;!campaign.is_end,'unstart':!campaign.is_start,'unjoin':campaign.join_flag!=1}" class="status">{{campaign.start_time | campaignStatus:campaign.end_time}}</span></div><a ng-href="#/location/{{campaign._id}}" class="item item_header cp_address"><span class="title">地点</span><span ng-cloak="ng-cloak" class="cp_location"> {{campaign.location.name}}</span><span class="icon icon_small ion-chevron-right button-clear"></span></a><a ng-if="!campaign.is_end &amp;&amp; (campaign.notices.length&gt;0 || campaign.allow.publishCampaignMessage)" ng-href="#/campaign/notice/{{campaign._id}}" class="item item_header"><span class="title">公告</span><span class="icon icon_small ion-chevron-right button-clear"></span></a>
      <div class="item item-text-wrap campaign_content">
        <p ng-cloak="ng-cloak" class="content_simple"> {{campaign.content ?campaign.content :'暂无'}}</p>
        <div class="operator"><a ng-href="#/campaign/content/{{campaign._id}}" class="more_content"> 更多活动详情</a></div>
      </div>
      <div class="item campaign_footer"><a ng-href="#/members/campaign/{{campaign._id}}" class="footer_col"><i class="ion_member dl_icon icon_small"></i><span ng-cloak="ng-cloak" class="footer_label"> 已报名({{campaign.members_count}})</span></a>
        <div ng-click="goDiscussDetail(campaign._id, campaign.theme)" class="footer_col"><i class="dl_icon ion_chat_circle"></i><span class="footer_label">活动讨论</span></div>
      </div>
      <score-board ng-if="campaign.is_end &amp;&amp; scoreBoardId" component-id="scoreBoardId"></score-board>
      <div class="item item-divider circle"><span>精彩瞬间</span><i ng-if="campaign.join_flag==1" post-circle="post-circle" campaign="campaign" class="icon ion-camera"></i></div>
      <circle-card-list circle-list="circleContentList" user="user" ctrl="circleCardListCtrl" on-click-comment-button="openCommentBox" on-click-content-img="onClickContentImg" on-click-blank="clickBlank" static-url="STATIC_URL"></circle-card-list>
      <ion-infinite-scroll ng-if="loadingStatus.hasMore &amp;&amp; loadingStatus.hasInit" icon="ion-looping" on-infinite="loadMore()" distance="1%"></ion-infinite-scroll>
    </div>
  </ion-content>
  <circle-comment-box ctrl="circleCommentBoxCtrl" on-post="postComment"></circle-comment-box>
  <photo-swipe ctrl="pswpCtrl"></photo-swipe>
  <ion-footer-bar ng-if="campaign.allow.joinTeamCampaign || campaign.allow.joinCompanyCampaign ||campaign.allow.quitCampaign">
    <button ng-if="campaign.allow.joinTeamCampaign || campaign.allow.joinCompanyCampaign" ng-click="join(campaign._id)" class="button button-full dl_cp_join">报名参加</button>
    <button ng-if="campaign.allow.quitCampaign" ng-click="quit(campaign._id)" class="button button-full dl_cp_quit">已经参加</button>
  </ion-footer-bar>
</ion-view>