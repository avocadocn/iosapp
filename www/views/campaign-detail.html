
<ion-view class="dl_campaign_detail">
  <ion-header-bar><a ng-click="goBack()" class="button icon-left ion-chevron-left">&nbsp;返回</a>
    <h1 ng-bind="campaign.campaign_unit[0].team.name || campaign.campaign_unit[0].company.name" class="title"></h1><a ng-if="campaign.active &amp;&amp; campaign.allow.editTeamCampaign || campaign.allow.editCompanyCampaign" href="#/campaign/edit/{{campaign._id}}" class="button dl_cp_edit">编辑</a>
  </ion-header-bar>
  <ion-content delegate-handle="detailScroll">
    <ion-refresher refreshing-icon="ion-looping" on-refresh="doRefresh()"></ion-refresher>
    <div ng-if="campaign" class="campaign_detail">
      <div ng-if="campaign.campaign_unit.length==1" class="campaign_info">
        <div class="cp_logos logos_{{campaign.campaign_unit.length}}"><a ng-href="{{campaign.campaign_unit[0].team._id ? '#/team/'+ campaign.campaign_unit[0].team._id: ''}}"><img ng-src="{{STATIC_URL + (campaign.campaign_unit[0].team.logo || campaign.campaign_unit[0].company.logo)}}/60/60" class="team_logo"/></a></div>
        <div ng-cloak="ng-cloak" class="campaign_theme"> {{campaign.theme + (!campaign || campaign.active ? '' : '(已关闭)')}}</div>
        <div class="operator">
          <button ng-if="campaign.allow.joinTeamCampaign || campaign.allow.joinCompanyCampaign" ng-click="join(campaign._id)" class="button dl_cp_join">马上参加</button>
        </div>
        <div class="campaign_status"><span ng-class="{'now':campaign.is_start&amp;&amp;!campaign.is_end,'unstart':!campaign.is_start,'unjoin':campaign.join_flag!=1}" class="status">{{campaign.is_start | campaignStatus:campaign.is_end}}</span></div>
      </div>
      <div ng-if="campaign.campaign_unit.length==2" class="campaign_info campaign_info_2">
        <div class="cp_logos"><a ng-href="{{campaign.campaign_unit[0].team._id ? '#/team/'+ campaign.campaign_unit[0].team._id: ''}}"><img ng-src="{{STATIC_URL + (campaign.campaign_unit[0].logo || campaign.campaign_unit[0].company.logo)}}/60/60" class="team_logo"/></a><span ng-if="campaign.campaign_type===4 || campaign.campaign_type===5" class="competition_type">挑战</span><span ng-if="campaign.campaign_type===7" class="competition_type">联谊</span><a ng-href="{{campaign.campaign_unit[1].team._id ? '#/team/'+ campaign.campaign_unit[1].team._id: ''}}"><img ng-src="{{STATIC_URL + (campaign.campaign_unit[1].team.logo || campaign.campaign_unit[1].company.logo)}}/60/60" class="team_logo team_logo_2"/></a></div>
        <div class="campaign_tname">{{campaign.campaign_unit[1].team.name}}</div>
        <div class="campaign_cname">{{campaign.campaign_unit[1].company.name}}</div>
        <div class="campaign_status"><span ng-class="{'now':campaign.is_start&amp;&amp;!campaign.is_end,'unstart':!campaign.is_start,'unjoin':campaign.join_flag!=1}" class="status">{{campaign.is_start | campaignStatus:campaign.is_end}}</span></div>
      </div>
      <div class="campaign_items">
        <div class="item item_header cp_time">
          <svg class="svg_icon">
            <use xlink:href="#time"></use>
          </svg><span ng-cloak="ng-cloak">{{campaign.start_time | date:"MM-dd HH:mm"}} ~ {{campaign.end_time | date:"MM-dd  HH:mm" }}</span>
        </div><a ng-href="#/location/{{campaign._id}}" class="item item_header cp_address">
          <svg class="svg_icon cp_info_icon">
            <use xlink:href="#location"></use>
          </svg><span ng-cloak="ng-cloak" class="cp_location"> {{campaign.location.name}}</span><span class="icon icon_small ion-chevron-right button-clear"></span></a>
      </div>
      <div class="campaign_items"><a ng-href="#/campaign/content/{{campaign._id}}" class="item item_header cp_time">
          <svg class="svg_icon">
            <use xlink:href="#time"></use>
          </svg><span>活动详情</span><span class="icon icon_small ion-chevron-right button-clear"></span></a>
        <div ng-if="campaign.content" class="item item-text-wrap campaign_content">
          <p ng-cloak="ng-cloak" class="content_simple"> {{campaign.content}}</p>
        </div>
      </div>
      <div class="item campaign_footer"><a ng-href="#/members/campaign/{{campaign._id}}" class="footer_col">
          <svg class="svg_icon">
            <use xlink:href="#renshu"></use>
          </svg><span ng-cloak="ng-cloak" class="footer_label"> 已报名({{campaign.members_count}})</span></a>
        <div ng-click="goDiscussDetail(campaign._id, campaign.theme)" class="footer_col">
          <svg class="svg_icon discussion_icon">
            <use xlink:href="#discussion"></use>
          </svg><span class="footer_label">活动讨论</span>
        </div>
      </div>
      <div class="item item-divider circle"><span>精彩瞬间</span>
        <svg ng-if="campaign.join_flag==1" post-circle="post-circle" campaign="campaign" after-post="doRefresh()" class="svg_icon">
          <use xlink:href="#camera"></use>
        </svg>
      </div>
      <circle-card-list circle-list="circleContentList" user="user" ctrl="circleCardListCtrl" on-click-comment-button="openCommentBox" on-click-content-img="onClickContentImg" on-click-blank="clickBlank" static-url="STATIC_URL"></circle-card-list>
      <ion-infinite-scroll ng-if="loadingStatus.hasMore &amp;&amp; loadingStatus.hasInit" icon="ion-looping" on-infinite="loadMore()" distance="1%"></ion-infinite-scroll>
    </div>
  </ion-content>
  <circle-comment-box ctrl="circleCommentBoxCtrl" on-post="postComment"></circle-comment-box>
  <photo-swipe ctrl="pswpCtrl"></photo-swipe>
  <ion-footer-bar ng-if="campaign.active &amp;&amp;(campaign.allow.joinTeamCampaign || campaign.allow.joinCompanyCampaign ||campaign.allow.quitCampaign)">
    <button ng-if="campaign.allow.joinTeamCampaign || campaign.allow.joinCompanyCampaign" ng-click="join(campaign._id)" class="button button-full dl_cp_join">报名参加</button>
    <button ng-if="campaign.allow.quitCampaign" ng-click="quit(campaign._id)" class="button button-full dl_cp_quit">已经参加</button>
  </ion-footer-bar>
</ion-view>