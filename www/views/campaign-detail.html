
<ion-view class="dl_campaign_detail">
  <ion-header-bar><a ng-click="goBack()" class="button icon-left ion-chevron-left">&nbsp;返回</a>
    <h1 ng-cloak="ng-cloak" class="title">{{campaign.theme + (!campaign || campaign.active ? '' : '(已关闭)')}}</h1><a ng-if="campaign.active &amp;&amp; campaign.allow.editTeamCampaign || campaign.allow.editCompanyCampaign" href="#/campaign/edit/{{campaign._id}}" class="button dl_cp_edit">编辑</a>
  </ion-header-bar>
  <ion-content delegate-handle="detailScroll">
    <div ng-cloak="ng-cloak" class="campaign_detail">
      <div class="campaign_info">
        <div class="cp_logos logos_{{campaign.campaign_unit.length}}"><a ng-href="{{campaign.campaign_unit[0].team._id ? '#/team/'+ campaign.campaign_unit[0].team._id: ''}}"><img ng-repeat="campaign_unit in campaign.campaign_unit" ng-src="{{STATIC_URL + (campaign_unit.team.logo || campaign_unit.company.logo)}}/60/60" class="team_logo"/></a>
          <div ng-if="campaign.campaign_type===4 || campaign.campaign_type===5" class="provoke_label"><span>挑战</span></div>
          <div ng-if="campaign.campaign_type===7" class="fellowship_label"><span>联谊 </span></div><a ng-href="{{campaign.campaign_unit[0].team._id ? '#/team/'+ campaign.campaign_unit[0].team._id: ''}}"></a>
        </div>
        <div ng-bind="campaign.campaign_unit[0].team.name || campaign.campaign_unit[0].company.name" class="team_name"></div>
        <div class="cp_time"><i class="icon icon_small ion_time"></i><span ng-cloak="ng-cloak">{{campaign.start_time | date:"MM-dd HH:mm"}} ~~ {{campaign.end_time | date:"MM-dd  HH:mm" }}</span></div>
        <div ng-if="campaign.is_start" ng-cloak="ng-cloak" class="cp_member"><i class="icon icon_small ion_member"></i><span class="member_num">{{campaign.members_count}}</span><span ng-if="campaign.member_max" class="member_num">&nbsp;|&nbsp;{{campaign.member_max}}</span></div>
        <div ng-if="!campaign.is_start" ng-cloak="ng-cloak" class="cp_address"><i class="icon icon_small ion_address"></i><span class="cp_location">{{campaign.location.name}}</span></div>
      </div><a ng-if="campaign.is_start || campaign.allow.quitCampaign" ng-href="#/location/{{campaign._id}}" ng-cloak="ng-cloak" class="item item_header cp_address"><span class="cp_location_title">活动地点:</span><span class="cp_location">{{campaign.location.name}}</span><span class="icon icon_small ion-chevron-right button-clear"></span></a>
      <div ng-if="campaign &amp;&amp; !campaign.is_start &amp;&amp; !campaign.allow.quitCampaign" ng-cloak="ng-cloak" class="item campaign_footer"><a ng-href="#/members/campaign/{{campaign._id}}" class="footer_col">
          <div class="ion_member dl_icon icon_small"></div>
          <div class="footer_label">已报名({{campaign.members_count}})</div></a>
        <div ng-click="goDiscussDetail(campaign._id, campaign.theme)" class="footer_col">
          <div class="dl_icon ion_chat_circle"></div>
          <div class="footer_label">活动讨论</div>
        </div>
      </div><a ng-if="campaign.notices.length&gt;0 || campaign.allow.publishCampaignMessage" ng-href="#/campaign/notice/{{campaign._id}}" class="item item_header"><span>活动公告</span><span class="icon icon_small ion-chevron-right button-clear"></span></a>
      <div ng-if="campaign &amp;&amp; !campaign.is_start &amp;&amp; !campaign.allow.quitCampaign" class="item item-text-wrap"><span class="dl_card_title">活动详情:</span>
        <p>{{campaign.content ?campaign.content :'暂无'}}</p>
      </div><a ng-if="campaign.is_start || campaign.allow.quitCampaign" ng-href="#/campaign/content/{{campaign._id}}" class="item item_header"><span>活动详情</span><span class="icon icon_small ion-chevron-right button-clear"></span></a>
      <div ng-if="!campaign.is_start &amp;&amp; campaign.allow.quitCampaign" class="item campaign_footer">
        <div ng-click="quit(campaign._id)" class="footer_col">
          <div class="dl_icon ion_log_out"></div>
          <div class="footer_label">退出</div>
        </div>
        <div ng-click="goDiscussDetail(campaign._id, campaign.theme)" class="footer_col">
          <div class="dl_icon ion_chat_circle"></div>
          <div class="footer_label">讨论</div>
        </div>
      </div><a ng-if="campaign.is_start" ng-click="goDiscussDetail(campaign._id, campaign.theme)" class="item item_header"><span>讨论</span><span class="icon icon_small ion-chevron-right button-clear"></span></a>
      <div class="item item-divider circle"><span>精彩瞬间</span><i post-circle="post-circle" campaign="campaign" class="icon ion-camera"></i></div>
      <circle-card-list circle-list="circleContentList" user="user" ctrl="circleCardListCtrl" on-click-comment-button="openCommentBox" on-click-content-img="onClickContentImg" static-url="STATIC_URL"></circle-card-list>
      <ion-infinite-scroll ng-if="loadingStatus.hasMore &amp;&amp; loadingStatus.hasInit" icon="ion-looping" on-infinite="loadMore()" distance="1%"></ion-infinite-scroll>
    </div>
  </ion-content>
  <circle-comment-box ctrl="circleCommentBoxCtrl" on-post="postComment" on-stop="stopComment"></circle-comment-box>
  <photo-swipe photos="imagesForPswp" ctrl="pswpCtrl"></photo-swipe>
  <ion-footer-bar ng-if="campaign.allow.joinTeamCampaign || campaign.allow.joinCompanyCampaign">
    <button ng-if="campaign.allow.joinTeamCampaign || campaign.allow.joinCompanyCampaign" ng-click="join(campaign._id)" class="button button-full dl_cp_join">报名参加</button>
  </ion-footer-bar>
</ion-view>